<div class="layout-container">
	<app-initial-header [text]="''" [textMargin]="'-4rem'" [showSidebarToggle]="false"
		(toggleSidebar)="onToggleSidebar()" [isFixed]="true"></app-initial-header>

	<div class="main-content">
		<div class="contenedor-formulario">
			<div class="form-header">
				<button mat-icon-button class="back-button" (click)="goBack()">
					<mat-icon>arrow_back</mat-icon>
				</button>
				<h1>Restablecer Contraseña</h1>
			</div>

			<div class="form-two-column-layout">
				<!-- Sección izquierda: Ilustración/Icono -->
				<div class="form-illustration">
					<div class="illustration-container">
						<mat-icon class="main-illustration">lock_reset</mat-icon>
						<div class="illustration-background"></div>
					</div>
					<h3>Recupera tu acceso</h3>
					<p>Ingresa tu nueva contraseña siguiendo los requisitos de seguridad para proteger tu cuenta del
						sistema de inventario.</p>
				</div>

				<!-- Sección derecha: Formulario -->
				<div class="form-container">
					<form [formGroup]="recoveryForm" (ngSubmit)="onSubmit()" class="formulario">
						<!-- Información del Usuario -->
						<h2 class="form-section-title">
							<mat-icon>security</mat-icon>
							Seguridad de la Cuenta
						</h2>

						<!-- Email (inmutable) -->
						<div class="form-row">
							<div class="custom-input-group full-width">
								<input id="email" type="email" [value]="userEmail" readonly placeholder=" ">
								<label for="email">Correo Electrónico</label>
								<div class="readonly-note">
									<mat-icon>lock</mat-icon>
									Este campo no puede ser modificado
								</div>
							</div>
						</div>

						<!-- Nueva Contraseña -->
						<div class="form-row">
							<div class="custom-input-group full-width">
								<div class="password-container">
									<input id="newPassword" [type]="showNewPassword ? 'text' : 'password'"
										formControlName="newPassword" required placeholder=" ">
									<button type="button" class="toggle-password"
										(click)="togglePasswordVisibility('newPassword')">
										<mat-icon>{{ showNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
									</button>
									<label for="newPassword">Nueva Contraseña</label>
								</div>
								<div class="error-message" *ngIf="hasFieldError('newPassword')">
									{{ getFieldError('newPassword') }}
								</div>
							</div>
						</div>

						<!-- Confirmar Contraseña -->
						<div class="form-row">
							<div class="custom-input-group full-width">
								<div class="password-container">
									<input id="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'"
										formControlName="confirmPassword" required placeholder=" ">
									<button type="button" class="toggle-password"
										(click)="togglePasswordVisibility('confirmPassword')">
										<mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
									</button>
									<label for="confirmPassword">Confirmar Nueva Contraseña</label>
								</div>
								<div class="error-message" *ngIf="hasFieldError('confirmPassword')">
									{{ getFieldError('confirmPassword') }}
								</div>
								<div class="error-message" *ngIf="recoveryForm.hasError('passwordsMismatch') &&
									recoveryForm.get('confirmPassword')?.touched">
									Las contraseñas no coinciden
								</div>
								<!-- Requisitos de contraseña -->
								<div class="password-requirements">
									<h4>La contraseña debe contener:</h4>
									<ul>
										<li [class.valid]="hasMinLength()">Mínimo 8 caracteres</li>
										<li [class.valid]="hasLowerCase()">Al menos una minúscula</li>
										<li [class.valid]="hasUpperCase()">Al menos una mayúscula</li>
										<li [class.valid]="hasNumber()">Al menos un número</li>
										<li [class.valid]="hasSpecialChar()">Al menos un carácter especial</li>
									</ul>
								</div>
							</div>
						</div>

						<!-- Botones de acción -->
						<div class="form-actions">
							<button mat-stroked-button type="button" (click)="goBack()" class="cancel-button">
								Cancelar
							</button>
							<button mat-raised-button type="submit" [disabled]="recoveryForm.invalid || isSubmitting"
								class="submit-button">
								{{ isSubmitting ? 'Restableciendo...' : 'Restablecer Contraseña' }}
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
